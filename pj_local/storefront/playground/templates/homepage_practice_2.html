<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <style>
        .container{
            display: flex;
            justify-content: right; 
            align-items: center;
            padding-top: 0%;
        }
        .bg-default{
            background-color:rgba(176, 196, 226, 1);
            color: aqua;
            border-color:blue;
        }
        .btn-default{
            background-color:rgba(255, 193, 37, 1);
            color: white;
            border-color:rgba(255, 193, 37, 1);
        }
        .bdcard{
            width: 300px;
            float:left; /* 圖片在左邊 */
            padding: 20px;
          }
        .bdtext{
            float: right;  /* 文字在右邊 */
            width: 430px;
            padding: 20px 20px 0px 0px;
          }
    </style>
</head>

<!--橫幅-->
<body>

    <div class="jumbotron jumbotron-fluid bg-default text-light" > 
        <!--<div class="alpha">-->
        <h1 class="display-4" style="text-align:center;">通勤族的救星</h1>
    </div>

    <div class="bdcard">
    <img src="IMG_0001.jpg" alt="map_view" width="500" height="400">
    </div>
        
<!--輸入起終點及時間的form-->    

    <div class="container">
        <div class="box">
            <form action="" method="get">
                <label for="startpoint">起點:</label>
                <br>
                <input type="text" size=40 id="startpoint" name="startpoint" placeholder="Enter a place" required="required">
                <br><br>
                <label for="endpoint">終點:</label>
                <br>
                <input type="text" size=40 id="endpoint" name="endpoint" placeholder="Enter a place" required="required">
                <br><br>
               
                <script>
                    let autocomplete;
                    let autocomplete2;
                    location_dic={"start":[],"end":[]}
                    function initAutocomplete()
                    {   autocomplete2 = new google.maps.places.Autocomplete
                        (
                            document.getElementById("endpoint"),
                            {
                                types: ['establishment'],
                                componentRestrictions: {'country':['TW']},
                                fields: ['name','geometry'],
                                bounds:{
                                    east:122.00166,
                                    west:120.98718,
                                    south:24.93971,
                                    north:25.29955,
                                },
                                
                            }
                        );
                        autocomplete = new google.maps.places.Autocomplete
                        (
                            document.getElementById("startpoint"),
                            {
                                types: ['establishment'],
                                componentRestrictions: {'country':['TW']},
                                fields: ['name','geometry'],
                                bounds:{
                                    east:122.00166,
                                    west:120.98718,
                                    south:24.93971,
                                    north:25.29955,
                                }
                                
                            }
                        );
                        autocomplete.addListener('place_changed',onPlanceChanged);
                        autocomplete2.addListener('place_changed',onPlanceChanged2);    
                    }
                    function onPlanceChanged()
                    {   
                        var place = autocomplete.getPlace();
                       
                        if (!place.geometry) 
                        {
                            document.getElementById('startpoint').value='';
                
                        }
                        else 
                        {
                            document.getElementById('startpoint').innerHTML=place.name;
                            console.log(place);
                            location_dic["start"]=[];  
                            location_dic["start"].push(place.geometry.location.lat());
                            location_dic["start"].push(place.geometry.location.lng());
                            console.log(location_dic["start"]);
                            if (location_dic["start"].length==2 && location_dic["end"].length==2)
                            {
                                console.log("it's ready to run init_map");
                                initMap()
                            }
                
                        }
                       
                    }
                    function onPlanceChanged2()
                    {
                        var place2 = autocomplete2.getPlace();
                       
                        if (!place2.geometry) 
                        {
                            document.getElementById('endpoint').value='';
                 
                        }
                        else 
                        {
                            document.getElementById('endpoint').innerHTML=place2.name;
                            console.log(place2);
                            location_dic["end"]=[];  
                            location_dic["end"].push(place2.geometry.location.lat());
                            location_dic["end"].push(place2.geometry.location.lng());
                            console.log(location_dic["end"])
                            if (location_dic["start"].length==2 && location_dic["end"].length==2)
                            {
                                console.log("it's ready to run init_map");
                                initMap()
                            }
                        }
                    }
                    function initMap() 
                    {
                        // 載入路線服務與路線顯示圖層
                        var directionsService = new google.maps.DirectionsService();
                        // 路線相關設定
                        var request = 
                        {
                            origin: { lat:location_dic["start"][0], lng:location_dic["start"][1]},
                            destination: { lat:location_dic["end"][0], lng:location_dic["end"][1] },
                            travelMode: 'DRIVING',
                            avoidFerries: true,
                            avoidHighways: true,
                            avoidTolls: true,
                            provideRouteAlternatives: true,
                        };
                        path_dic={"path_lat0":[],"path_lat1":[],"path_lat2":[],"path_lng0":[],"path_lng1":[],"path_lng2":[]}
                        // 繪製路線
                        directionsService.route(request, function (result, status) 
                        {
                            if (status == 'OK') 
                            {
                
                                for (i=0;i<result.routes.length;i++)
                                    {  
                                       for (k=0;k<result.routes[i].legs[0].steps.length;k++)
                                        {   
                                            for (e=0;e<result.routes[i].legs[0].steps[k].path.length;e++)
                                            {   
                                                path_dic["path_lat"+i].push(result.routes[i].legs[0].steps[k].path[e].lat()) 
                                                path_dic["path_lng"+i].push(result.routes[i].legs[0].steps[k].path[e].lng())       
                                            };
                                        }; 
                                    }
                                            var result =false ; //預設值
                                $.ajax({
                                url : "/playground/ajax/do",
                                type : "post",
                                data : {"data":JSON.stringify(path_dic)},
                                async : false,
                                success : function(data) {
                                result =data['message'] ; //回傳值
                                console.log(result)
                                }
                                });  
                            }
                            
                            else {
                                console.log(status);
                            }
                        });
                    }
                </script>

                <label for="date">出發日期:</label>
                <br>
                <input type="date" value={{min_date}} min={{min_date}} max={{max_date}} step="1" name="date" id="date">
            
                <!--<input type='date'size=40 value='2022-07-22' min='2022-07-22' max='2022-07-30' step='1'>-->                
                <br><br>
                <label for="time">出發時間:</label>
                <br>
                <input type='time' name="time" id="time" size=40 min='00:00' max='23:59' step='1'>
                <br><br>
               <!--<button type="submit" value="submit" class="ban ben-primary">submit</botton>-->
                <button type="submit" value="submit" class="btn btn-default">submit</button>
              </form> 
       <br><br><br>
        </div>
    </div>
  
<!--    
 <div class="jumbotron">
  <h1 class="display-4">Hello, world!</h1>
  <p class="lead">This is a simple hero unit, a simple jumbotron-style component for calling extra attention to featured content or information.</p>
  <hr class="my-4">
  <p>It uses utility classes for typography and spacing to space content out within the larger container.</p>
  <p class="lead">
    <a class="btn btn-primary btn-lg" href="#" role="button">Learn more</a>
  </p>
</div>
-->


</body>
</html>

<script src="https://maps.googleapis.com/maps/api/js?
key=AIzaSyCqOi_RU3EnuPtGxz5tidTPiLaDEVxxUnA&libraries=places&callback=initAutocomplete"
async defer></script>